<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title th:text="${titulo}">Gesti√≥n de Pedidos - Matpi</title>
    <link rel="icon" th:href="@{/img/Favicon.png}" />
    <link rel="stylesheet" th:href="@{/css/app.css}" />
    <link rel="stylesheet" th:href="@{/css/table.css}" />
  </head>
  <body>
    <div th:replace="fragments/header :: header(${activeModule})"></div>

    <main>
      <section class="formulario-seccion">
        <div class="dashboard-header">
          <h1>üìã Gesti√≥n de Pedidos</h1>
          <p>Administra todos los pedidos del restaurante</p>
        </div>

        <!-- Botones de acci√≥n -->
        <div class="action-buttons" style="margin-bottom: 20px">
          <button onclick="nuevoPedido()" class="btn-primary">
            ‚ûï Nuevo Pedido
          </button>
          <a th:href="@{/pedidos/reportes}" class="btn-secondary"
            >üìä Ver Reportes</a
          >
        </div>

        <!-- Tabla de pedidos -->
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Fecha</th>
                <th>Cliente</th>
                <th>Mesa</th>
                <th>Estado</th>
                <th>Valor</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr th:if="${#lists.isEmpty(pedidos)}">
                <td colspan="7" style="text-align: center">
                  No hay pedidos registrados
                </td>
              </tr>
              <tr th:each="pedido : ${pedidos}">
                <td th:text="${pedido.id}">1</td>
                <td
                  th:text="${#temporals.format(pedido.fecha, 'dd/MM/yyyy HH:mm')}"
                >
                  01/01/2024 10:00
                </td>
                <td
                  th:text="${pedido.nombreCliente != null ? pedido.nombreCliente : 'Cliente General'}"
                >
                  Cliente
                </td>
                <td th:text="${pedido.mesa != null ? pedido.mesa : 'N/A'}">
                  Mesa 1
                </td>
                <td>
                  <span
                    class="badge"
                    th:classappend="${pedido.estado == 'Pendiente' ? 'badge-warning' : 
                                                       (pedido.estado == 'En Preparaci√≥n' ? 'badge-info' : 
                                                       (pedido.estado == 'Entregado' ? 'badge-success' : 
                                                       (pedido.estado == 'Pagado' ? 'badge-primary' : 'badge-danger')))}"
                    th:text="${pedido.estado}"
                    >Pendiente</span
                  >
                </td>
                <td
                  th:text="'$' + ${#numbers.formatDecimal(pedido.valor, 0, 'COMMA', 2, 'POINT')}"
                >
                  $50,000
                </td>
                <td>
                  <button
                    onclick="verDetalle([[${pedido.id}]])"
                    class="btn-action btn-view"
                    title="Ver Detalle"
                  >
                    üëÅÔ∏è
                  </button>
                  <button
                    onclick="editarPedido([[${pedido.id}]])"
                    class="btn-action btn-edit"
                    title="Editar"
                  >
                    ‚úèÔ∏è
                  </button>
                  <button
                    onclick="eliminarPedido([[${pedido.id}]])"
                    class="btn-action btn-delete"
                    title="Eliminar"
                  >
                    üóëÔ∏è
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <footer>
      <p>¬© 2025 Matpi. Todos los derechos reservados.</p>
    </footer>

    <script>
      function nuevoPedido() {
        alert("Funcionalidad de crear pedido pr√≥ximamente");
        // TODO: Implementar modal o redirect a formulario de creaci√≥n
      }

      function verDetalle(id) {
        alert("Ver detalle del pedido " + id);
        // TODO: Implementar modal con detalle del pedido
      }

      function editarPedido(id) {
        alert("Editar pedido " + id);
        // TODO: Implementar formulario de edici√≥n
      }

      function eliminarPedido(id) {
        if (confirm("¬øEst√° seguro de eliminar el pedido #" + id + "?")) {
          fetch("/pedidos/api/" + id, {
            method: "DELETE",
          })
            .then((response) => {
              if (response.ok) {
                alert("Pedido eliminado exitosamente");
                location.reload();
              } else {
                alert("Error al eliminar el pedido");
              }
            })
            .catch((error) => {
              console.error("Error:", error);
              alert("Error al eliminar el pedido");
            });
        }
      }
    </script>

    <style>
      .action-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .btn-primary,
      .btn-secondary {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        font-weight: bold;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-secondary {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
      }

      .btn-action {
        padding: 5px 10px;
        margin: 0 2px;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-size: 14px;
      }

      .btn-view {
        background: #3498db;
        color: white;
      }

      .btn-edit {
        background: #f39c12;
        color: white;
      }

      .btn-delete {
        background: #e74c3c;
        color: white;
      }

      .badge {
        padding: 5px 10px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: bold;
      }

      .badge-warning {
        background: #f39c12;
        color: white;
      }

      .badge-info {
        background: #3498db;
        color: white;
      }

      .badge-success {
        background: #27ae60;
        color: white;
      }

      .badge-primary {
        background: #9b59b6;
        color: white;
      }

      .badge-danger {
        background: #e74c3c;
        color: white;
      }
    </style>
  </body>
</html>
